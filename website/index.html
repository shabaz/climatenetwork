<!doctype html>
<html>
    <head>
        <meta charset='utf-8'>

        <script src="sylvester.js" type="text/javascript"></script>
        <script src="glUtils.js" type="text/javascript"></script>
        <script src="webgl-demo.js" type="text/javascript"></script>
        <script src="degree-plot.js" type="text/javascript"></script>
        <script src="community-plot.js" type="text/javascript"></script>

        <script id="shader-fs" type="x-shader/x-fragment">
            varying highp vec2 vTextureCoord;
            uniform sampler2D uSampler;
            uniform int dataType;

            //based on http://geog.uoregon.edu/datagraphics/color/BuDRd_12.txt
            lowp vec3 colorForTemp(lowp float temp) {
                if (temp < -2.0) {
                    temp = min((temp+2.0)/-70.0, 1.0);
                    lowp vec3 blue = vec3(0.164, 0.043, 0.850);
                    lowp vec3 white = vec3(0.880, 1.000, 1.000);
                    return (1.0-temp) * white + temp * blue;
                } else if (temp > 2.0) {
                    temp = min((temp-2.0)/40.0, 1.0);
                    lowp vec3 white = vec3(1.000, 1.000, 0.750);
                    lowp vec3 red = vec3(0.650, 0.000, 0.130);
                    return (1.0-temp) * white + temp * red;
                } else {
                    temp = min((temp+2.0)/4.0, 1.0);
                    lowp vec3 redwhite = vec3(1.000, 1.000, 0.750);
                    lowp vec3 bluewhite = vec3(0.880, 1.000, 1.000);
                    return (1.0-temp) * bluewhite + temp * redwhite;
                }
            }

            //http://geog.uoregon.edu/datagraphics/color/BrBu_10.txt
            lowp vec3 colorForHum(lowp float hum) {
                lowp vec3 colors[10];
                colors[0] = vec3(0.400, 0.187, 0.000);
                colors[1] = vec3(0.600, 0.379, 0.210);
                colors[2] = vec3(0.800, 0.608, 0.480);
                colors[3] = vec3(0.850, 0.688, 0.595);
                colors[4] = vec3(0.950, 0.855, 0.808);
                colors[5] = vec3(0.800, 0.993, 1.000);
                colors[6] = vec3(0.600, 0.973, 1.000);
                colors[7] = vec3(0.400, 0.940, 1.000);
                colors[8] = vec3(0.200, 0.893, 1.000);
                colors[9] = vec3(0.000, 0.667, 0.800);

                int left = int(min(floor(hum/11.1),8.0));
                lowp float lerpVal = (hum - float(left)*11.1)/11.1;
                for (int i = 0; i < 9; i++)
                {
                    if (i == left) {
                        return colors[i] * (1.0-lerpVal) + colors[i+1] * lerpVal;
                    }
                }
           }
            //http://geog.uoregon.edu/datagraphics/color/BuOr_8.txt
            lowp vec3 colorForPres(lowp float pres) {
                lowp vec3 colors[8];
                colors[0] = vec3(0.000, 0.500, 1.000);
                colors[1] = vec3(0.300, 0.767, 1.000);
                colors[2] = vec3(0.600, 0.933, 1.000);
                colors[3] = vec3(0.800, 1.000, 1.000);
                colors[4] = vec3(1.000, 1.000, 0.800);
                colors[5] = vec3(1.000, 0.933, 0.600);
                colors[6] = vec3(1.000, 0.767, 0.300);
                colors[7] = vec3(1.000, 0.500, 0.000);

                pres = min((pres-495.0)/600.0,1.0);

                int left = int(min(floor(pres * 7.0), 6.0));
                lowp float lerpVal = fract(pres*7.0);

                for (int i = 0; i < 7; i++)
                {
                    if (i == left) {
                        return colors[i] * (1.0-lerpVal) + colors[i+1] * lerpVal;
                    }
                }
           }


            //http://geog.uoregon.edu/datagraphics/color/BuGy_8.txt
            lowp vec3 colorForPrec(lowp float prec) {
                lowp vec3 colors[8];
                colors[0] = vec3(0.000, 0.600, 0.800);
                colors[1] = vec3(0.400, 0.900, 1.000);
                colors[2] = vec3(0.600, 1.000, 1.000);
                colors[3] = vec3(0.800, 1.000, 1.000);
                colors[4] = vec3(0.900, 0.900, 0.900);
                colors[5] = vec3(0.600, 0.600, 0.600);
                colors[6] = vec3(0.400, 0.400, 0.400);
                colors[7] = vec3(0.200, 0.200, 0.200);


                prec = 1.0-min((prec+4.0)/74.0,1.0);

                int left = int(min(floor(prec * 7.0), 6.0));
                lowp float lerpVal = fract(prec*7.0);

                for (int i = 0; i < 7; i++)
                {
                    if (i == left) {
                        return colors[i] * (1.0-lerpVal) + colors[i+1] * lerpVal;
                    }
                }
            }

            lowp vec3 colorForCommunity(lowp float community) {

                lowp float red = fract((float(int(community) * 124123))/1000.0);
                lowp float green = fract((float(int(community) * 3445223))/1000.0);
                lowp float blue = fract((float(int(community) * 125722))/1000.0);
                return vec3(red,green,blue);




                if (community == 1.0) {
                    return vec3(1.0, 0.0, 0.0);
                } else if (community == 2.0) {
                    return vec3(0.0, 1.0, 0.0);
                } else if (community == 3.0) {
                    return vec3(0.0, 0.0, 1.0);
                } else if (community == 4.0) {
                    return vec3(0.0, 1.0, 1.0);
                } else if (community == 5.0) {
                    return vec3(1.0, 0.0, 1.0);
                } else if (community == 6.0) {
                    return vec3(1.0, 1.0, 0.0);
                } else if (community > 6.0) {
                    return vec3(1.0, 1.0, 1.0);
                } else {
                    return vec3(0.0, 0.0, 0.0);
                }
            }

            void main(void) {
                if (dataType == 0) {
                    lowp float temp = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)).x;
                    gl_FragColor.xyz = colorForTemp(temp);
                } else if (dataType == 1) {
                    lowp float hum = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)).x;
                    gl_FragColor.xyz = colorForHum(hum);
                } else if (dataType == 2) {
                    lowp float prec = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)).x;
                    gl_FragColor.xyz = colorForPrec(prec);
                } else if (dataType == 3) {
                    lowp float pres = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)).x;
                    gl_FragColor.xyz = colorForPres(pres);
                } else if (dataType == 4) {
                    lowp float degree = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)).x;
                    gl_FragColor.xyz = vec3(1.0,1.0,1.0)*pow(degree,0.4);
                } else if (dataType == 5) {
                    lowp float community = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)).x;
                    gl_FragColor.xyz = colorForCommunity(community);
                } else  {
                    gl_FragColor.xyz = vec3(1.0,0.0,0.0);
                }
                gl_FragColor.a = 1.0;
            }
        </script>

        <script id="shader-vs" type="x-shader/x-vertex">
            attribute vec3 aVertexPosition;
            attribute vec2 aTexCoord;

            varying highp vec2 vTextureCoord;
            

            uniform mat4 uMVMatrix;
            uniform mat4 uPMatrix;

            void main(void) {
                gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
                vTextureCoord = aTexCoord;
            }
        </script>
        <link href="style.css" rel="stylesheet">
    </head>
    <body onload="startDegreePlot();startCommunityPlot();">
        <div id="main">
            <header>
            <h1 onclick="document.documentElement.mozRequestFullScreen()">Analysing the Climate System using Complex Networks</h1>
            <p id="names">Victor Azizi, Andrew Bedard, Shabaz Sultan</p>
            </header>
            <div id="left-column" style="width:800px; height:100%; float:left;">
            <article>
            <h2>Datasets</h2>
            <canvas id="glcanvas" width="640" height="480">
            Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
            </canvas>
            <br/>

            <input type=range min=0 max=808 value=0 step=1 oninput="document.getElementById('dataset-animate').checked = false; updateSlider(this.value);" id="dataset-range" style="width:600px;">
            <input id="dataset-animate" type=checkbox onchange="animateDataset();">
            <p>The 
            <select id="dataset-select" style="-moz-appearance:none; border:none; font-size:100%; min-width:10%;" onchange="updateDataset();">
                <option value="everything">precipitable water, temperature, pressure and humidity</option>
                <option value="temperature">temperature</option>
                <option value="precipitation">precipitable water</option>
                <option value="humidity">humidity</option>
                <option value="pressure">pressure</option>
            </select>  
            data at <span id="dataset-date">January, 1948</span>. 
            <!--span class='cite'>Kalnay, E., Kanamitsu, M., Kistler, R., Collins, W., Deaven, D., Gandin, L., … Joseph, D. (1996). The NCEP/NCAR 40-year reanalysis project. Bulletin of the American Meteorological Society.<cite-->
                </article>
                <article>
                <h2>Network Construction</h2>
                </article>

            <article>
            <h2>Basic Network Metrics</h2>
            <canvas id="degree-canvas" width="640" height="480" style="box-shadow: 10px 10px 5px #888888; margin-bottom:30px">
            Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
            </canvas>
            <br/>
            <input type=range min=0 max=11 value=0 step=1 oninput="updateDegreeSlider(this.value);" id="degree-range" style="width:600px;">
            <p>The degree of the network based on 
            
            
            <select id="degree-dataset-select" style="-moz-appearance:none; border:none; font-size:100%; min-width:10%;" onchange="updateDegreeSet();">
                <option value="temperature">univariate correlation on temperature</option>
                <option value="pressure">univariate correlation on pressure</option>
                <option value="precipitation">univariate correlation on precipitable water</option>
                <option value="humidity">univariate correlation on humidity</option>
                <option value="multivariate">multivariate correlation on four variables</option>
            </select>  
            
            in the period <span id="degree-date">1948 to 1953</span>.</p>
        </article>
        </div>
        <div id="center-column" style="width:800px; height:100%; display: inline-block;">
            <article>
            <h2>Community Detection</h2>
            <canvas id="community-canvas" width="640" height="480" style="box-shadow: 10px 10px 5px #888888; margin-bottom:30px">
            Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
            </canvas>
            <br/>
            <input type=range min=0 max=11 value=0 step=1 oninput="updateCommunitySlider(this.value);" id="community-range" style="width:600px;">
            <p>
            Communities detected in the period <span id="community-date">1948 to 1953</span>.</p>
        </div>
        </article>
        <div id="right-column" style="width:800px; height:100%; float:right;">
            <article>
            <h2>References</h2>

            <p id='cite'>Kalnay, E., Kanamitsu, M., Kistler, R., Collins, W., Deaven, D., Gandin, L., … Joseph, D. (1996). The NCEP/NCAR 40-year reanalysis project. Bulletin of the American Meteorological Society.</p>
            </article>
            </div>
        </body>
    </html>
